{% extends "hms/layout/base.html" %}
{% block title %}Inventory Items{% endblock %}

{% block content %}
<div class="container-xl">
  <div class="page-header d-print-none">
    <div class="row align-items-center">
      <div class="col">
        <h2 class="page-title">Inventory Items</h2>
      </div>
      <div class="col-auto ms-auto">
        <a href="{{ url_for('hms.inventory_item_add') }}" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
          Add Item
        </a>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card mb-3">
    <div class="card-body">
      <form method="GET" class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" name="search" placeholder="Search items..." value="{{ request.args.get('search', '') }}">
        </div>
        <div class="col-md-3">
          <select class="form-select" name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}" {% if request.args.get('category')|int == cat.id %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <select class="form-select" name="filter">
            <option value="">All Items</option>
            <option value="low_stock" {% if request.args.get('filter') == 'low_stock' %}selected{% endif %}>Low Stock</option>
            <option value="out_of_stock" {% if request.args.get('filter') == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
          </select>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary">Apply Filters</button>
          <a href="{{ url_for('hms.inventory_items') }}" class="btn btn-link">Clear</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Items Table -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-vcenter card-table table-striped">
        <thead>
          <tr>
            <th>SKU</th>
            <th>Name</th>
            <th>Category</th>
            <th>Unit</th>
            <th>Current Stock</th>
            <th>Reorder Level</th>
            <th>Avg Cost</th>
            <th>Status</th>
            <th class="w-1"></th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td><code>{{ item.sku }}</code></td>
            <td>
              <a href="#">{{ item.name }}</a>
              {% if item.description %}
              <span class="badge bg-info" title="{{ item.description }}">?</span>
              {% endif %}
            </td>
            <td>{{ item.category.name }}</td>
            <td>{{ item.unit }}</td>
            <td>
              <span class="fw-bold">{{ "%.2f"|format(item.current_stock) }}</span>
            </td>
            <td>{{ item.reorder_level }}</td>
            <td>${{ "%.2f"|format(item.average_cost) }}</td>
            <td>
              {% if item.current_stock <= 0 %}
                <span class="badge bg-danger">Out of Stock</span>
              {% elif item.current_stock <= item.reorder_level %}
                <span class="badge bg-warning">Low</span>
              {% else %}
                <span class="badge bg-success">OK</span>
              {% endif %}
            </td>
            <td>
              <div class="btn-group">
                <a href="#" class="btn btn-sm btn-outline-secondary">Edit</a>
                <a href="{{ url_for('hms.inventory') }}" class="btn btn-sm btn-outline-primary">History</a>
                <a href="#" class="btn btn-sm btn-outline-warning">Adjust</a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="9" class="text-center text-muted">No items found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    {% if pagination %}
    <div class="card-footer d-flex align-items-center">
      <p class="m-0 text-muted">
        Showing <span>{{ pagination.first }}</span> to <span>{{ pagination.last }}</span> of <span>{{ pagination.total }}</span> entries
      </p>
      <ul class="pagination m-0 ms-auto">
        {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('hms.inventory_items') }}">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <polyline points="15 6 9 12 15 18" />
            </svg>
            prev
          </a>
        </li>
        {% endif %}
        
        {% for page in pagination.iter_pages() %}
          {% if page %}
            <li class="page-item {% if page == pagination.page %}active{% endif %}">
              <a class="page-link" href="{{ url_for('hms.inventory_items', page=page, **request.args) }}">{{ page }}</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">â€¦</span></li>
          {% endif %}
        {% endfor %}
        
        {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('hms.inventory_items') }}">
            next
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <polyline points="9 6 15 12 9 18" />
            </svg>
          </a>
        </li>
        {% endif %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
