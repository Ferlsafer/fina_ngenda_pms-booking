{% if categories %}
<div class="card-header">
  <ul class="nav nav-tabs card-header-tabs" id="menu-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
        All Items
        <span class="badge bg-secondary ms-2">{{ total_items }}</span>
      </button>
    </li>
    {% for category in categories %}
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cat-{{ category.id }}-tab" data-bs-toggle="tab" data-bs-target="#cat-{{ category.id }}" type="button" role="tab">
        <div class="d-flex align-items-center">
          <span>{{ category.name }}</span>
          <span class="badge bg-secondary ms-2">{{ category.items.count() }}</span>
          <div class="dropdown ms-2">
            <button class="btn btn-icon btn-sm btn-ghost-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <circle cx="12" cy="12" r="1" />
                <circle cx="12" cy="19" r="1" />
                <circle cx="12" cy="5" r="1" />
              </svg>
            </button>
            <ul class="dropdown-menu">
              <li>
                <button class="dropdown-item" onclick="editCategory({{ category.id }})">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M9 7h-3a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-3" />
                    <path d="M9 15h3l8.5 -8.5a1.5 1.5 0 0 0 -3 -3l-8.5 8.5v3" />
                  </svg>
                  Edit
                </button>
              </li>
              <li>
                <button class="dropdown-item text-danger" onclick="deleteCategory({{ category.id }})">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <line x1="4" y1="7" x2="20" y2="7" />
                    <line x1="10" y1="11" x2="10" y2="17" />
                    <line x1="14" y1="11" x2="14" y2="17" />
                    <path d="M5 7l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -14" />
                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                  </svg>
                  Delete
                </button>
              </li>
            </ul>
          </div>
        </div>
      </button>
    </li>
    {% endfor %}
  </ul>
</div>
{% else %}
<div class="card-header">
  <div class="card-title">Menu Categories</div>
  <div class="card-actions">
    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#category-modal">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
      Add First Category
    </button>
  </div>
</div>
{% endif %}

<script>
function editCategory(categoryId) {
  // Fetch category data via AJAX
  fetch(`/restaurant/api/category/${categoryId}`)
    .then(response => response.json())
    .then(data => {
      // Fill and show edit modal
      const modal = document.getElementById('category-modal');
      modal.querySelector('.modal-title').textContent = 'Edit Category';
      modal.querySelector('form').action = `/restaurant/category/${categoryId}/edit`;
      modal.querySelector('input[name="name"]').value = data.name;
      modal.querySelector('textarea[name="description"]').value = data.description || '';
      modal.querySelector('input[name="display_order"]').value = data.display_order;
      
      // Show modal
      new bootstrap.Modal(modal).show();
    });
}

function deleteCategory(categoryId) {
  if (confirm('Are you sure you want to delete this category? Items in this category will not be deleted but will become uncategorized.')) {
    fetch(`/restaurant/category/${categoryId}/delete`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token() }}'
      }
    }).then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('Failed to delete category');
      }
    });
  }
}
</script>
