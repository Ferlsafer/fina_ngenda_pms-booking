{% extends "hms/layout/base.html" %}
{% block title %}Gallery Management - Hotel PMS{% endblock %}

{% block content %}
<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">Website Gallery</h2>
      <div class="text-muted mt-1">Manage images for your website gallery</div>
    </div>
    <div class="col-auto">
      <a href="{{ url_for('hms.settings_gallery_upload') }}" class="btn btn-primary">
        <i class="fa fa-upload"></i> Upload New Image
      </a>
    </div>
  </div>
</div>

{% if images %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Gallery Images ({{ images|length }})</h3>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-vcenter table-bordered">
            <thead>
              <tr>
                <th style="width: 150px;">Preview</th>
                <th>Title</th>
                <th>Category</th>
                <th>Size</th>
                <th>Order</th>
                <th>Status</th>
                <th style="width: 200px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for image in images %}
              <tr>
                <td>
                  <img src="{{ image.url }}" alt="{{ image.title }}" 
                       style="width: 120px; height: 80px; object-fit: cover; border-radius: 4px;">
                </td>
                <td>
                  <strong>{{ image.title }}</strong>
                  {% if image.description %}
                  <div class="text-muted small mt-1">{{ image.description[:50] }}...</div>
                  {% endif %}
                </td>
                <td>
                  <span class="badge badge-{{ 
                    'azure' if image.category == 'rooms' else 
                    'green' if image.category == 'facilities' else 
                    'orange' if image.category == 'dining' else 
                    'purple' 
                  }}">
                    {{ image.category|title }}
                  </span>
                </td>
                <td>
                  <span class="badge badge-{{ 
                    'red' if image.size_type == 'large' else 
                    'yellow' if image.size_type == 'medium' else 
                    'gray' 
                  }}">
                    {{ image.size_type|title }}
                  </span>
                </td>
                <td>{{ image.sort_order }}</td>
                <td>
                  {% if image.is_active %}
                  <span class="badge bg-success">Active</span>
                  {% else %}
                  <span class="badge bg-secondary">Hidden</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-list btn-list-sm">
                    <a href="{{ image.url }}" target="_blank" class="btn btn-sm btn-info" title="View Full Size">
                      <i class="fa fa-eye"></i>
                    </a>
                    <a href="{{ url_for('hms.settings_gallery_edit', image_id=image.id) }}" 
                       class="btn btn-sm btn-warning" title="Edit">
                      <i class="fa fa-edit"></i>
                    </a>
                    <button type="button" class="btn btn-sm btn-{{ 'danger' if image.is_active else 'success' }}" 
                            onclick="toggleImage({{ image.id }}, {{ image.is_active|lower }})" title="{{ 'Hide' if image.is_active else 'Show' }}">
                      <i class="fa fa-{{ 'eye-slash' if image.is_active else 'eye' }}"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" 
                            onclick="deleteImage({{ image.id }}, '{{ image.title }}')" title="Delete">
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% else %}
<!-- Empty state -->
<div class="text-center py-5">
  <i class="fa fa-images text-muted" style="font-size: 4rem;"></i>
  <h3 class="mt-4">No Gallery Images Yet</h3>
  <p class="text-muted mt-2">Upload images to display on your website gallery page.</p>
  <a href="{{ url_for('hms.settings_gallery_upload') }}" class="btn btn-primary mt-3">
    <i class="fa fa-upload"></i> Upload First Image
  </a>
</div>
{% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal modal-blur fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
    <div class="modal-content">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-status bg-danger"></div>
      <div class="modal-body text-center py-4">
        <i class="fa fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        <h3 class="mb-2 mt-3">Delete Image?</h3>
        <p class="text-muted">
          Are you sure you want to delete "<strong id="deleteImageName"></strong>"? 
          This action cannot be undone.
        </p>
        <form id="deleteForm" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mt-4">
            <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-danger w-100 mt-2">
              <i class="fa fa-trash"></i> Delete
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function deleteImage(imageId, imageName) {
  document.getElementById('deleteImageName').textContent = imageName;
  document.getElementById('deleteForm').action = '/hms/settings/gallery/' + imageId + '/delete';
  var modal = new bootstrap.Modal(document.getElementById('deleteModal'));
  modal.show();
}

function toggleImage(imageId, isActive) {
  fetch('/hms/settings/gallery/' + imageId + '/toggle', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      alert('Error: ' + data.error);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Failed to update image status');
  });
}
</script>
{% endblock %}
